{% extends "layouts/base.html" %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('banking.static', filename='styles/banking.css') }}" />
{% endblock %}

{% block extra_js %}
  <script src="{{ url_for('banking.static', filename='js/banking.js') }}" defer></script>
{% endblock %}

{% block content %}
  <section class="banking-overview">
    <header class="banking-overview__header">
      <h1>Lifesim — Banking</h1>
      <p>Track liquid funds, shift money between accounts, and log every transfer for full visibility.</p>
    </header>
    <div class="account-grid">
      {% for account in accounts %}
        <article
          class="account-card"
          data-account-card
          data-account="{{ account.id }}"
          data-balance="{{ '%.2f'|format(account.balance) }}"
        >
          <h2>{{ account.name }}</h2>
          <p class="account-card__type">{{ account.type }}</p>
          <p class="account-card__balance">
            <span data-balance-value>${{ '%.2f'|format(account.balance) }}</span>
          </p>
        </article>
      {% endfor %}
    </div>
    <div class="transfer-panel" aria-label="Manage cash movement">
      <article class="transfer-card">
        <h2>Move cash into accounts</h2>
        <p>Shift money from your wallet into checking or savings and document the transfer.</p>
        <form id="form-hand-to-account" class="transfer-form">
          <div class="form-row">
            <label for="hand-transfer-name">Transaction name</label>
            <input
              id="hand-transfer-name"
              name="name"
              type="text"
              placeholder="Paycheck deposit"
              required
            />
          </div>
          <div class="form-row">
            <label for="hand-transfer-description">Description</label>
            <input
              id="hand-transfer-description"
              name="description"
              type="text"
              placeholder="Income moved from cash to checking"
              required
            />
          </div>
          <div class="form-row">
            <label for="hand-transfer-amount">Amount</label>
            <input
              id="hand-transfer-amount"
              name="amount"
              type="number"
              min="0.01"
              step="0.01"
              required
            />
          </div>
          <div class="form-row">
            <label for="hand-transfer-destination">Destination</label>
            <select id="hand-transfer-destination" name="destination" required>
              <option value="" disabled selected>Select an account</option>
              <option value="checking">Checking</option>
              <option value="savings">Savings</option>
            </select>
          </div>
          <button type="submit" class="transfer-button">Deposit into account</button>
          <p class="form-feedback" data-feedback hidden></p>
        </form>
      </article>
      <article class="transfer-card">
        <h2>Replenish cash on hand</h2>
        <p>Move funds out of checking or savings to give yourself spending flexibility.</p>
        <form id="form-account-to-hand" class="transfer-form">
          <div class="form-row">
            <label for="account-withdraw-name">Transaction name</label>
            <input
              id="account-withdraw-name"
              name="name"
              type="text"
              placeholder="ATM withdrawal"
              required
            />
          </div>
          <div class="form-row">
            <label for="account-withdraw-description">Description</label>
            <input
              id="account-withdraw-description"
              name="description"
              type="text"
              placeholder="Moved from checking to wallet"
              required
            />
          </div>
          <div class="form-row">
            <label for="account-withdraw-amount">Amount</label>
            <input
              id="account-withdraw-amount"
              name="amount"
              type="number"
              min="0.01"
              step="0.01"
              required
            />
          </div>
          <div class="form-row">
            <label for="account-withdraw-source">Source</label>
            <select id="account-withdraw-source" name="source" required>
              <option value="" disabled selected>Select an account</option>
              <option value="checking">Checking</option>
              <option value="savings">Savings</option>
            </select>
          </div>
          <button type="submit" class="transfer-button">Move funds to cash</button>
          <p class="form-feedback" data-feedback hidden></p>
        </form>
      </article>
    </div>
  </section>

  <section class="transaction-ledger" aria-label="Account transfer history">
    <header>
      <h2>Transfer log</h2>
      <p>Every deposit or withdrawal with its story, so you always know where the money went.</p>
    </header>
    <div class="transaction-ledger__table">
      <table class="transaction-table">
        <thead>
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Description</th>
            <th scope="col">Account</th>
            <th scope="col" class="transaction-table__amount">Amount</th>
          </tr>
        </thead>
        <tbody data-ledger-body>
          {% for transaction in banking_state.transactions %}
            {% set sign = '+' if transaction.direction == 'credit' else '−' %}
            <tr data-direction="{{ transaction.direction }}">
              <td>{{ transaction.name }}</td>
              <td>{{ transaction.description }}</td>
              <td>{{ banking_state.account_labels[transaction.account] }}</td>
              <td class="transaction-amount {{ transaction.direction }}">
                {{ sign }}${{ '%.2f'|format(transaction.amount) }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <p class="ledger-empty" data-ledger-empty {% if banking_state.transactions %}hidden{% endif %}>
        No transfers recorded yet. Move funds to populate your history.
      </p>
    </div>
  </section>

  <section class="goal-tracker" aria-label="Financial goals">
    <header>
      <h2>Goals and contributions</h2>
      <button type="button" class="goal-toggle">Toggle projections</button>
    </header>
    <div class="goal-grid">
      {% for goal in goals %}
        <article class="goal" data-target="{{ goal.target }}" data-current="{{ goal.current }}">
          <h3>{{ goal.goal }}</h3>
          <p>Target: ${{ goal.target }}</p>
          <p>Current: ${{ goal.current }}</p>
          <div class="goal__progress" role="progressbar" aria-valuemin="0" aria-valuemax="{{ goal.target }}" aria-valuenow="{{ goal.current }}">
            <div class="goal__progress-bar"></div>
          </div>
        </article>
      {% endfor %}
    </div>
  </section>

  <script id="banking-data" type="application/json">{{ banking_state | tojson }}</script>
{% endblock %}
