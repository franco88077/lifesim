{% extends "layouts/base.html" %}

{% block extra_css %}
  <link rel="stylesheet" href="{{ url_for('banking.static', filename='styles/banking.css') }}" />
{% endblock %}

{% block extra_js %}
  <script src="{{ url_for('banking.static', filename='js/banking.js') }}" defer></script>
{% endblock %}

{% block content %}
  <div class="banking-shell">
    <section class="banking-subnav" aria-label="Banking navigation">
      <nav class="banking-tabs">
        <a
          href="{{ url_for('banking.home') }}"
          class="banking-tab{% if active_banking_tab == 'home' %} is-active{% endif %}"
          {% if active_banking_tab == 'home' %}aria-current="page"{% endif %}
        >
          Banking Home
        </a>
        {% if has_bank_accounts %}
          <a
            href="{{ url_for('banking.insights') }}"
            class="banking-tab{% if active_banking_tab == 'insights' %} is-active{% endif %}"
            {% if active_banking_tab == 'insights' %}aria-current="page"{% endif %}
          >
            Account Insights
          </a>
          <a
            href="{{ url_for('banking.transfer') }}"
            class="banking-tab{% if active_banking_tab == 'transfer' %} is-active{% endif %}"
            {% if active_banking_tab == 'transfer' %}aria-current="page"{% endif %}
          >
            Banking Transfer
          </a>
        {% endif %}
        <a
          href="{{ url_for('banking.settings') }}"
          class="banking-tab{% if active_banking_tab == 'settings' %} is-active{% endif %}"
          {% if active_banking_tab == 'settings' %}aria-current="page"{% endif %}
        >
          Banking Settings
        </a>
      </nav>
    </section>

    <section class="banking-overview">
      <header class="banking-overview__header">
        <h1>{{ bank_settings.bank_name }} â€” Banking Transfer</h1>
        <p>Move money between any two accounts.</p>
      </header>
      <div class="transfer-balances" aria-label="Available funds">
        <h2>Available Funds</h2>
        <p>Check balances before you submit a transfer to keep cash, checking, and savings aligned.</p>
        {% set account_label_map = {'checking': 'CHECKING', 'savings': 'SAVINGS'} %}
        <div class="account-grid">
          {% for account in accounts %}
            {% set account_label = account_label_map.get(account.id, account.name) %}
            {% set show_account_type = account.id not in account_label_map and account.type %}
            <article class="account-card summary-card" data-account-card data-account="{{ account.id }}">
              <header>
                {% if show_account_type %}
                  <p class="account-card__type">{{ account.type }}</p>
                {% endif %}
                <h2>{{ account_label }}</h2>
              </header>
              <p class="account-card__balance">
                <span data-balance-value>{{ account.display_balance }}</span>
              </p>
            </article>
          {% endfor %}
        </div>
      </div>
      <div class="transfer-panel" aria-label="Manage cash movement">
        {% if can_transfer %}
          <article class="transfer-card transfer-card--wide">
            <h2>Transfer Funds</h2>
            <p>Move money between any two accounts.</p>
            <form
              id="form-account-transfer"
              class="transfer-form"
              data-endpoint="{{ url_for('banking.api_move') }}"
            >
              <div class="form-grid">
                <label for="account-transfer-source">
                  <span>Source account</span>
                  <select
                    id="account-transfer-source"
                    name="source"
                    required
                    data-transfer-source
                  >
                    <option value="" disabled selected>Select a source</option>
                    {% for account in accounts %}
                      {% set account_label = account_label_map.get(account.id, account.name) %}
                      <option value="{{ account.id }}">{{ account_label }}</option>
                    {% endfor %}
                  </select>
                </label>
                <label for="account-transfer-destination">
                  <span>Destination account</span>
                  <select
                    id="account-transfer-destination"
                    name="destination"
                    required
                    data-transfer-destination
                  >
                    <option value="" disabled selected>Select a destination</option>
                    {% for account in accounts %}
                      {% set account_label = account_label_map.get(account.id, account.name) %}
                      <option value="{{ account.id }}">{{ account_label }}</option>
                    {% endfor %}
                  </select>
                </label>
                <label for="account-transfer-amount" class="form-grid__amount">
                  <span>Amount</span>
                  <input
                    id="account-transfer-amount"
                    name="amount"
                    type="number"
                    min="0.01"
                    step="0.01"
                    required
                  />
                </label>
              </div>
              <div class="transfer-guidelines" data-transfer-guidelines data-state="idle">
                <div class="transfer-guideline" data-guideline="source" hidden></div>
                <div class="transfer-guideline" data-guideline="destination" hidden></div>
              </div>
              <button type="submit" class="transfer-button">Submit transfer</button>
              <p class="form-feedback" data-feedback hidden></p>
            </form>
          </article>
        {% else %}
          <article class="transfer-card transfer-card--wide">
            <h2>Transfer Funds</h2>
            <p>
              Open a checking or savings account to enable transfers between cash and your banking portfolio.
            </p>
          </article>
        {% endif %}
      </div>
    </section>

  </div>

  <script id="banking-data" type="application/json">{{ banking_state | tojson }}</script>
{% endblock %}
